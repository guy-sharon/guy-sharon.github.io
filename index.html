<!DOCTYPE html>
<html>
<head>
  <title>מדריך טיולים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Verdana, Geneva, Tahoma, sans-serif; text-align: center; 
        background: #f0f4f8; }
    button { 
      background: #0b72b9; color:  rgb(255, 255, 255); font-size: 3em; 
      padding: 10px 20px; margin: 10px 23px; border: none; border-radius: 15px;
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    h1 { color: #2a2344; font-size : 2.5em; margin-top: 30px; }
  </style>

  <script>
        async function registerServiceWorker() {
            if ("serviceWorker" in navigator) {
            try {
                const registration = await navigator.serviceWorker.register(
                    "sw.js"
                );
                console.log(
                "Service Worker registered with scope:",
                registration.scope
                );
            } catch (error) {
                console.error("Service Worker registration failed:", error);
            }
            }
        }

        registerServiceWorker();
  </script>

  <script>
        // Function to check user's location
        function open_navigation(destLat, destLng, waze) {
            if (waze) {
                window.location.href = `https://waze.com/ul?ll=${destLat},${destLng}&navigate=yes`;
            }
            else {
                window.location.href = `https://www.google.com/maps/dir/?api=1&destination=${destLat},${destLng}&travelmode=walking`;
            }
        }

        function checkLocation(destLat, destLng, placeName, verified_locations, verify_dists_km, waze) {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser.');
                return;
            }
            navigator.geolocation.getCurrentPosition((position) => {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                // Calculate distance in km using Haversine formula
                const R = 6371; // Earth radius in km
                all_locs = verified_locations.slice();
                all_locs.push([destLat, destLng]);
                for (let i = 0; i < all_locs.length; i++) {
                    const vLat = all_locs[i][0];
                    const vLng = all_locs[i][1];
                    const dLatV = (vLat - userLat) * Math.PI / 180;
                    const dLngV = (vLng - userLng) * Math.PI / 180;
                    const aV = Math.sin(dLatV/2) * Math.sin(dLatV/2) +
                              Math.cos(userLat * Math.PI / 180) * Math.cos(vLat * Math.PI / 180) *
                              Math.sin(dLngV/2) * Math.sin(dLngV/2);
                    const cV = 2 * Math.atan2(Math.sqrt(aV), Math.sqrt(1-aV));
                    const distanceV = R * cV;
                    console.log(distanceV);
                    if (distanceV <= verify_dists_km[i]) {
                        // User is within a verified location
                        open_navigation(destLat, destLng, waze);
                        return;
                    }
                }

                var msg = "האם אתם בטוחים שברצונכם להגיע ל"
                msg += `${placeName}`
                msg += "?"
                const proceed = confirm(msg);
                if (proceed) {
                    open_navigation(destLat, destLng, waze);
                }

            }, () => {
                open_navigation(destLat, destLng, waze);
            },
            {
                maximumAge: 60000,  // use cached location up to 60s
                timeout: 500
            });
        }
    </script>
</head>
<body>
  <h1>מדריך טיולים</h1>
    <h2>3/08</h2>      <button onclick="checkLocation(59.579631217030496, 9.173712088688937, 'כנסיית העץ העתיקה', [[59.91028747001133, 10.759149875920937], [59.84136536105944, 10.451532708227695], [59.76953468860811, 10.20983348823977], [59.76953468833935, 9.902216326736134], [59.6698211140157, 9.649530779118379], [59.59484073364515, 9.391352091948987]], [10, 10, 10, 10, 10, 11], 1)">1
        <div style="font-size: 0.4em; margin-top: 0.3em;">כנסיית העץ העתיקה</div>
        </button>
    
      <button onclick="checkLocation(59.559214890632845, 9.261338597651902, 'נוטודן', [[59.91028747001133, 10.759149875920937]], [10], 1)">2
        <div style="font-size: 0.4em; margin-top: 0.3em;">נוטודן</div>
        </button>
    
      <button onclick="checkLocation(59.76946921278479, 7.389044921790655, 'מלון ווגסלידטון', [[59.604428973465716, 9.002843569125318], [59.601952753759186, 8.714106257699223], [59.5213762499024, 8.479201326369518], [59.57718052131577, 8.227167910463688], [59.64773329594539, 8.016732242814161], [59.70826557919452, 7.847894323420936], [59.758831062258956, 7.5983078338831245]], [10, 10, 10, 10, 10, 10, 10], 1)">3
        <div style="font-size: 0.4em; margin-top: 0.3em;">מלון ווגסלידטון</div>
        </button>
    
    <h2>4/08</h2>      <button onclick="checkLocation(59.94824252336145, 6.58365642803515, 'מפלי לטפוסן', [[59.76787559060073, 7.3895109972957815], [59.7876269314034, 7.297952525058634], [59.82051986619606, 7.203124107384445], [59.84735836460373, 7.087586035275664], [59.84735836460373, 6.9676880359174955], [59.84681085633585, 6.865229745556879], [59.81997191650139, 6.77803120056912], [59.84845335412083, 6.708272364578912], [59.89003626898682, 6.6494133467121745], [59.924466914624595, 6.590554328845437]], [4, 4, 4, 4, 4, 4, 4, 4, 4, 4], 1)">4
        <div style="font-size: 0.4em; margin-top: 0.3em;">מפלי לטפוסן</div>
        </button>
    
      <button onclick="checkLocation(60.32490612151451, 6.65844841798013, 'בית הקפה והמאפייה פלוי', [[59.76787559060073, 7.3895109972957815], [59.7876269314034, 7.297952525058634], [59.82051986619606, 7.203124107384445], [59.84735836460373, 7.087586035275664], [59.84735836460373, 6.9676880359174955], [59.84681085633585, 6.865229745556879], [59.81997191650139, 6.77803120056912], [59.84845335412083, 6.708272364578912], [59.89003626898682, 6.6494133467121745], [59.924466914624595, 6.590554328845437], [59.95284607423546, 6.582430909902832], [59.9975820888222, 6.5623918443092615], [60.04456685623816, 6.565474777477503], [60.091484863842105, 6.551601578220416], [60.13756865818384, 6.567016244061624], [60.17438927445983, 6.590138242823436], [60.217294554761054, 6.605552908664643], [60.25096651156644, 6.613260241585247], [60.28307565854426, 6.616343174753489], [60.307518630051774, 6.644089573267662]], [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4], 1)">5
        <div style="font-size: 0.4em; margin-top: 0.3em;">בית הקפה והמאפייה פלוי</div>
        </button>
    
      <button onclick="checkLocation(60.46689812548009, 7.0702280865386085, 'איידפיורד', [[59.77074552110632, 7.387719303695958], [59.84671279436948, 7.041649983356277], [59.88256436250444, 6.657128516312186], [60.002248481060924, 6.5637447314586215], [60.177551313893375, 6.577477640995911], [60.33289670959683, 6.64064902486744], [60.47126610499866, 6.942773034687797]], [13, 13, 13, 13, 13, 13, 13], 1)">6
        <div style="font-size: 0.4em; margin-top: 0.3em;">איידפיורד</div>
        </button>
    

  <script>
    function openLink(url) { window.location.href = url; }
  </script>
</body>
</html>
