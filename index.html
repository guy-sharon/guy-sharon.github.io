<!DOCTYPE html>
<html>
<head>
  <title>מדריך טיולים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Verdana, Geneva, Tahoma, sans-serif; text-align: center; 
        background: #f0f4f8; }
    button { 
      background: #0b72b9; color:  rgb(255, 255, 255); font-size: 3em; 
      padding: 10px 20px; margin: 10px 23px; border: none; border-radius: 15px;
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    h1 { color: #2a2344; font-size : 2.5em; margin-top: 30px; }
  </style>

  <script>
        async function registerServiceWorker() {
            if ("serviceWorker" in navigator) {
            try {
                const registration = await navigator.serviceWorker.register(
                    "sw.js"
                );
                console.log(
                "Service Worker registered with scope:",
                registration.scope
                );
            } catch (error) {
                console.error("Service Worker registration failed:", error);
            }
            }
        }

        registerServiceWorker();
  </script>

  <script>
        // Function to check user's location
        function open_navigation(destLat, destLng, waze) {
            if (waze) {
                window.location.href = `https://waze.com/ul?ll=${destLat},${destLng}&navigate=yes`;
            }
            else {
                window.location.href = `https://www.google.com/maps/dir/?api=1&destination=${destLat},${destLng}&travelmode=walking`;
            }
        }

        function checkLocation(destLat, destLng, placeName, verified_locations, verify_dists_km, waze) {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser.');
                return;
            }
            navigator.geolocation.getCurrentPosition((position) => {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                // Calculate distance in km using Haversine formula
                const R = 6371; // Earth radius in km
                all_locs = verified_locations.slice();
                all_locs.push([destLat, destLng]);
                for (let i = 0; i < all_locs.length; i++) {
                    const vLat = all_locs[i][0];
                    const vLng = all_locs[i][1];
                    const dLatV = (vLat - userLat) * Math.PI / 180;
                    const dLngV = (vLng - userLng) * Math.PI / 180;
                    const aV = Math.sin(dLatV/2) * Math.sin(dLatV/2) +
                              Math.cos(userLat * Math.PI / 180) * Math.cos(vLat * Math.PI / 180) *
                              Math.sin(dLngV/2) * Math.sin(dLngV/2);
                    const cV = 2 * Math.atan2(Math.sqrt(aV), Math.sqrt(1-aV));
                    const distanceV = R * cV;
                    console.log(distanceV);
                    if (distanceV <= verify_dists_km[i]) {
                        // User is within a verified location
                        open_navigation(destLat, destLng, waze);
                        return;
                    }
                }

                var msg = "האם אתם בטוחים שברצונכם להגיע ל"
                msg += `${placeName}`
                msg += "?"
                const proceed = confirm(msg);
                if (proceed) {
                    open_navigation(destLat, destLng, waze);
                }

            }, () => {
                open_navigation(destLat, destLng, waze);
            },
            {
                maximumAge: 60000,  // use cached location up to 60s
                timeout: 500
            });
        }
    </script>
</head>
<body>
  <h1>מדריך טיולים</h1>
    <h2>3/08</h2>      <button onclick="checkLocation(59.579631217030496, 9.173712088688937, 'כנסיית העץ העתיקה', [[59.91028747001133, 10.759149875920937], [59.84136536105944, 10.451532708227695], [59.76953468860811, 10.20983348823977], [59.76953468833935, 9.902216326736134], [59.6698211140157, 9.649530779118379], [59.59484073364515, 9.391352091948987]], [10, 10, 10, 10, 10, 11], 1)">1</button>
      <button onclick="checkLocation(59.76946921278479, 7.389044921790655, 'מלון ווגסלידטון', [[59.604428973465716, 9.002843569125318], [59.601952753759186, 8.714106257699223], [59.5213762499024, 8.479201326369518], [59.57718052131577, 8.227167910463688], [59.64773329594539, 8.016732242814161], [59.70826557919452, 7.847894323420936], [59.758831062258956, 7.5983078338831245]], [10, 10, 10, 10, 10, 10, 10], 1)">2</button>
    <h2>4/08</h2>      <button onclick="checkLocation(60.46673360531188, 7.068500369061384, 'איידפיורד', [[59.77074552110632, 7.387719303695958], [59.84671279436948, 7.041649983356277], [59.88256436250444, 6.657128516312186], [60.002248481060924, 6.5637447314586215], [60.177551313893375, 6.577477640995911], [60.33289670959683, 6.64064902486744], [60.47126610499866, 6.942773034687797]], [13, 13, 13, 13, 13, 13, 13], 1)">3</button>
      <button onclick="checkLocation(60.37024545975006, 6.108024022985264, 'מפלי שטיינסדלספוסן', [[60.4671063415852, 7.071674703857783], [60.478164871044946, 6.9549949548774705], [60.4925353265063, 6.820364475284801], [60.51684005789785, 6.705928567631032], [60.46931834894866, 6.607199549263075], [60.441657420014856, 6.465837545690771], [60.41175714571005, 6.36486468599627], [60.3840471817699, 6.248184937015956], [60.37295659022326, 6.138236712015276]], [6, 6, 6, 6, 6, 6, 6, 6, 6], 1)">4</button>
      <button onclick="checkLocation(60.39118163725193, 5.3216444182500835, 'ברגן', [[60.46444368600508, 7.070500607404774], [60.46997387537984, 6.913431714546659], [60.50203039840591, 6.803483489545979], [60.53736635829316, 6.729436725770012], [60.57597094201803, 6.637439231381687], [60.62993998410787, 6.500564910462472], [60.62773893200973, 6.312082239032736], [60.64534314264172, 6.11462420229682], [60.631040453818855, 5.9396045788263505], [60.59360340811992, 5.8161933058664035], [60.53957357600379, 5.728683494131168], [60.4743973485414, 5.7354150181108015], [60.44009965749914, 5.643417523722478], [60.4998206207743, 6.6733406926063985], [60.45669983789584, 6.55890478495263], [60.432350003256055, 6.419786622706872], [60.390248197799764, 6.27393693648148], [60.37149659381248, 6.09943492983304], [60.389774219066666, 5.9649563981270255], [60.378975043744816, 5.786772343616557], [60.39807884063268, 5.647250866971567], [60.421320513449416, 5.522858225143504], [60.446203886686334, 5.322821409230806], [60.30994200690759, 5.519496261850852], [60.23319478349703, 5.454281537155975], [60.309109392727244, 5.326183372523458], [60.39890918628314, 5.395103620022788]], [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7], 1)">5</button>
    <h2>5/08</h2>      <button onclick="checkLocation(60.39991067238998, 5.305273694648417, 'האקווריום הלאומי בברגן', [[60.39536382611946, 5.324827734455982]], [3], 1)">6</button>
      <button onclick="checkLocation(60.397803257417706, 5.32095634189529, 'נקודת מפגש לשייט במפרץ מוסטראומן', [], [], 0)">7</button>
    <h2>6/08</h2>      <button onclick="checkLocation(60.397563989685075, 5.324544119062977, 'מדרחוב בריגן', [], [], 0)">8</button>
      <button onclick="checkLocation(60.394751321111414, 5.325181579382361, 'שוק הדגים בברגן', [], [], 0)">9</button>
      <button onclick="checkLocation(60.39635497566565, 5.328403478094899, 'רכבל פלויבנן', [], [], 0)">10</button>
      <button onclick="checkLocation(60.39721576580881, 5.323410199767801, 'מסעדת יוניקורן פיש', [], [], 0)">11</button>
    <h2>7/08</h2>      <button onclick="checkLocation(60.87871641194426, 6.842783130309827, 'עמק הוויקינגים', [[60.40066570873266, 5.323763179332352], [60.462177279559754, 5.325596302854006], [60.45313875912446, 5.442916208239834], [60.42781751490292, 5.5620692371473135], [60.45585057942066, 5.734382848182747], [60.53168966268797, 5.728883477617786], [60.604652344445846, 5.822372777222117], [60.63702736803587, 5.9580239178244785], [60.64691325641476, 6.148668764076448], [60.62623930374835, 6.3338142397634565], [60.68463149136252, 6.456633515714244], [60.743813781079474, 6.493295986147315], [60.78947093617446, 6.561121556448497], [60.80735796205203, 6.645445238444559], [60.85024607629493, 6.764598267352039]], [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7], 1)">12</button>
      <button onclick="checkLocation(60.861997702411145, 7.112358780295647, 'פלם', [[60.891633364294144, 7.038671207753574], [60.88234900079604, 6.896964710116111]], [7, 7], 1)">13</button>
    <h2>8/08</h2>      <button onclick="checkLocation(60.95151192075261, 7.104576536199135, 'אונדרדל', [[60.878391678358604, 7.105231529246835]], [7], 1)">14</button>
      <button onclick="checkLocation(60.863025494522724, 7.114590114743707, 'רכבת פלם', [], [], 0)">15</button>
      <button onclick="checkLocation(60.86287674667964, 7.114571259500795, 'שייט במפרץ נארוי', [], [], 0)">16</button>
    <h2>9/08</h2>      <button onclick="checkLocation(60.863336897632855, 7.114682301430519, 'תחנת אוטובוס C תצפית סטגסטין', [], [], 0)">17</button>
      <button onclick="checkLocation(61.048663423927174, 7.814260366096567, 'כנסיית העץ בורגונד', [[60.88072412246814, 7.151068252896669], [60.900098465041886, 7.185400526739893], [60.91946104394952, 7.254065072693247], [60.93747770275531, 7.2980103832125724], [60.962150651335364, 7.346075566593083], [60.98813657163624, 7.41062024141834], [61.01476673988225, 7.449072388122749], [61.04403414117387, 7.483404661965972], [61.05467013871214, 7.524603390577839], [61.05068205789077, 7.587774774449368], [61.05068205789077, 7.653692740228355], [61.051346772880436, 7.708624378377511], [61.051346772880436, 7.769049180341582]], [2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5, 2.5], 1)">18</button>
      <button onclick="checkLocation(60.16839036222407, 10.25563852229932, 'הונפוס', [[61.04870646784796, 7.8145721451872685], [61.09321481987947, 8.213787636541655], [61.07828838258828, 8.628349570917184], [60.95862320943594, 8.407837903696157], [61.007826014149096, 8.919424971648938], [60.8857489981, 8.743015637872118], [60.89647624937489, 9.184038972314168], [60.76320314932188, 8.976758005126406], [60.79549758113771, 9.44424273963498], [60.63153685078923, 9.206090139036272], [60.60557178290706, 9.70003627361137], [60.45586661850836, 9.43983250629056], [60.44281604369537, 9.916137707487977], [60.305468131848905, 9.744138607055577], [60.26393202382515, 10.039624241131753]], [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16], 1)">19</button>

  <script>
    function openLink(url) { window.location.href = url; }
  </script>
</body>
</html>
